<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-icons/hardware-icons.html">
<link rel="import" href="../iron-icons/social-icons.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="../iron-menu-behavior/iron-menu-behavior.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">

<link rel="import" href="../uqlibrary-api/uqlibrary-api-account.html">
<link rel="import" href="../uqlibrary-api/uqlibrary-api-applications.html">

<!--
Element providing main navigation menu in Polymer v1
Element features:
  - skip navigation for accessibility
  - loads menu items from json file
  - notifies client for menu items loaded and menu item selected

##### Example

  <uqlibrary-menu
      user="{{user}}"
      menu-file="{{appMenuFile}}"
      on-selected-menu-item-changed="closeMenu"
      on-menu-items-changed="menuReloaded"
      on-logout-clicked="logout">

@element uqlibrary-menu
@blurb Element providing main navigation menu
@status alpha
@homepage https://github.com/uqlibrary/uqlibrary-menu
-->
<dom-module id="uqlibrary-menu">
  <style>
    #skipNavigation {
      position: fixed;
      z-index: 99999999999;
      left: -200px;
      top: -200px;

      margin: 5px;
      background-color: var(--skip-navigation-hidden-color);
      color: var(--primary-text-color);
    }

    #skipNavigation:focus {
      position: fixed;
      z-index: 99999999999;
      left: 0px;
      top: 0px;
      background-color: var(--skip-navigation-visible-color);
      color: var(--primary-text-color);
    }

    #menuItems a {
      color:  var(--menu-item-color);
      text-decoration: none;
    }

    #menuItems iron-icon {
      color: var(--menu-icon-color);
      margin-right: 16px;
    }

    #menuItems .divider {
      border-bottom: 1px solid --var(--divider-color);
    }

    #user#header {
      padding: 110px 14px 14px 16px;
      border-bottom: 1px solid --var(--divider-color);
      background: linear-gradient(to bottom, transparent 30%, black 100%);
      background: -webkit-gradient(linear, left top, left bottom, color-stop(30%, transparent), color-stop(100%, var(--menu-header-bg-color)));
      color: var(--menu-header-color);
    }

  </style>
  <template>


    <uqlibrary-api-applications id="apiApplications"
                                url="{{menuFile}}"
                                user="{{user}}"
                                on-uqlibrary-api-applications-loaded="menuDataLoaded"></uqlibrary-api-applications>

    <!-- accessibility "Skip navigation" anchor -->
    <paper-button id="skipNavigation" aria-label="skip navigation"
                  title="Skip navigation"
                  on-tap="handleSkipNavigation">Skip navigation
    </paper-button>
    <paper-toolbar>
      <div class="paper-font-headline">{{appTitle}}</div>
    </paper-toolbar>
    <div id="user" hidden$="{{!user.hasSession}}">
      <div id="header" class="reverse horizontal layout end flex">
        <div id="details" class="flex">
          <div id="name" class="body2 inverse">{{user.name}}</div>
          <div id="mail" class="body1 inverse">{{user.mail}}</div>
        </div>
        <paper-icon-button icon="lock"
                           aria-label="Logout"
                           title="Logout"
                           on-tap="logoutClicked"
                           id="askLogout"></paper-icon-button>
      </div>
    </div>
    <iron-menu-behavior id="menuItems">
      <template is="dom-repeat" items="{{menuItems}}">
        <template is="dom-if" if="{{item.isDivider}}">
          <div class="divider"></div>
        </template>
        <template is="dom-if" if="{{!item.isDivider}}">
          <a href="{{ item.link }}" id="{{ item.app }}" on-click="linkClicked" title="{{item.title}}">
            <paper-item>
              <iron-icon alt="{{ item.description }}" icon="{{ item.icon }}"></iron-icon>
              <span>{{item.title}}</span>
            </paper-item>
          </a>
        </template>
      </template>
    </iron-menu-behavior>
    <!-- accessibility "Skip navigation" anchor -->
    <div tabindex="0" style="opacity: 0;" id="content" aria-label="Start of content">Start of content</div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'uqlibrary-menu',

    hostAttributes: {
      role: 'navigation'
    },

    properties: {
      appTitle: {
        type: String,
        value: "UQ | Library"
      },
      user: Object,
      menuFile: String,
      menuItems: {
        type: Array,
        notify: true
      },
      selectedMenuItem: {
        type: Object,
        notify: true
      }
    },

    observers: [
      'getMenuData(user, menuFile)'
    ],

    getMenuData: function (user, menuFile) {
      this.$.apiApplications.get();
    },

    menuDataLoaded: function (e) {
      this.menuItems = e.detail;
    },

    handleSkipNavigation: function (e) {
      this.$.content.focus();
    },

    logoutClicked: function (e) {
      this.fire('logout-clicked');
    },

    linkClicked: function (e) {
      var item = (e && e.model && e.model.item) ? e.model.item : null;
      this.selectedMenuItem = item;
    }
  });
</script>

